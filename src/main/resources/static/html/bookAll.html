<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전체도서</title>
    <link rel="stylesheet" href="../css/init.css">
    <link rel="stylesheet" href="../css/header.css">
    <link rel="stylesheet" href="../css/bookAll.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gugi&family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="title"><a href="index.html" class="gugi-regular">세모책</a></div>
            <div class="topMenu">
                <ul>
                    <li><a href="bookAll.html">전체도서</a></li>
                    <li><a href="#">국내도서</a></li>
                    <li><a href="#">외국도서</a></li>
                </ul>
            </div>
            <div class="spacer">사용자 이모지</div>
        </header>
        <section>
            <div class="bookMenu">
                <ul>
                    <li><a>전체도서</a></li>
                    <li><a>국내도서</a></li>
                    <li><a>외국도서</a></li>
                </ul>
            </div>
            <div id="books">
                
            </div>
        </section>
        <footer>푸터</footer>
    </div>
</body>
<script>
    document.addEventListener("DOMContentLoaded", async() => {
        const bookList = document.getElementById("books");

        try {
            const response = await axios.get("http://localhost:8080/books");

            const books = response.data._embedded?.bookDTOList || [];
            books.forEach(book => {
                const div = document.createElement("div");
                div.className = "book";

                // 왼쪽: 이미지
                const imageWrapper = document.createElement("div");
                imageWrapper.className = "book-image-wrapper";

                const img = document.createElement("img");
                img.src = book.image;
                img.className = "book-cover";
                imageWrapper.appendChild(img);

                // 가운데: 도서 정보(제목, 저자, 발행사, 가격)
                const infoContainer = document.createElement("div");
                infoContainer.className = "book-info";

                const title = document.createElement("p");
                title.className = "book-title";
                title.textContent = book.title;
                title.addEventListener("click", async() => {
                    location.href = `bookDetail.html?isbn=${book.isbn}`
                })

                const subInfo = document.createElement("p");
                subInfo.className = "book-sub-info";
                subInfo.textContent = book.author
                    ? `${book.author} · ${book.publisher}`
                    : book.publisher;

                const price = document.createElement("p");
                price.className = "book-price";
                price.textContent = book.price == 0
                    ? `판매종료`
                    : `${book.price}원`;

                infoContainer.appendChild(title);
                infoContainer.appendChild(subInfo);
                infoContainer.appendChild(price);

                // 오른쪽: 버튼 모음
                const btns = document.createElement("div");
                btns.className = "book-btns";

                const btnFavorite = document.createElement("a");
                btnFavorite.className = "btn-favorite";
                btnFavorite.textContent = "찜하기";

                const btnCart = document.createElement("a");
                btnCart.className = "btn-cart";
                btnCart.textContent = "장바구니";

                const btnBuy = document.createElement("a");
                btnBuy.className = "btn-buy";
                btnBuy.textContent = "바로구매";

                btns.appendChild(btnFavorite);
                btns.appendChild(btnCart);
                btns.appendChild(btnBuy);

                // 조립
                div.appendChild(imageWrapper);
                div.appendChild(infoContainer);
                div.appendChild(btns);
                bookList.appendChild(div);
            })
        } catch (err) {
            bookList.innerHTML = err;
        }
    })
</script>
</html>